#!/usr/bin/env bash

SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &>/dev/null && pwd)
ENV_CONFIG_FILE="${SCRIPT_DIR}/../.env"

. "${ENV_CONFIG_FILE}"

. "${SPRING_BACK_END_DIR}"/bin/.env
. "${ANGULAR_FRONT_END_DIR}"/bin/.env

############################################################
# Help                                                     #
############################################################
help() {
    echo ""
    echo -e "Build or rebuild the Angular front-end and Spring Boot back-end Docker services. These services build an image from a Dockerfile." | fmt
    echo ""
    echo -e "Usage: $0 [-h] | [-p profile]" | fmt
    echo -e "\t-h\t Display this help message" | fmt
    echo ""
}

############################################################
############################################################
# Main Program                                             #
############################################################
############################################################

while getopts "h" opt; do
    case $opt in
    h)
        help
        exit 0
        ;;
    \?)
        echo "Invalid option: -$OPTARG" >&2
        help
        exit 1
        ;;
    :)
        echo ""
        echo "Option -$OPTARG requires an argument." >&2
        help
        exit 1
        ;;
    esac
done

echo
echo -e "Running docker compose build in ${SPRING_BACK_END_DIR}" | fmt
echo

cd "${SPRING_BACK_END_DIR}" && docker compose build

echo
echo -e "Running docker compose build in ${ANGULAR_FRONT_END_DIR}" | fmt
echo

cd "${ANGULAR_FRONT_END_DIR}" && docker compose build
